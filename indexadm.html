<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel Administrativo - GERA Audiovisual e Comunicação</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* === RESET E VARIÁVEIS === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --amarelo: #FFD700;
      --laranja: #FF8C00;
      --vermelho: #fc520f;
      --branco: #FFFFFF;
      --preto: #000000;
      --cinza-fundo: #f5f5f5;
      --cinza-sidebar: #2c3e50;
      --cinza-card: #ffffff;
      --cinza-medio: #e0e0e0;
      --cinza-escuro: #34495e;
      --sombra: 0 4px 12px rgba(0, 0, 0, 0.08);
      --sombra-hover: 0 6px 16px rgba(0, 0, 0, 0.12);
      --transicao: all 0.3s ease;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--cinza-fundo);
      color: var(--preto);
      overflow-x: hidden;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* === ANIMAÇÕES E KEYFRAMES === */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .fade-in {
      animation: fadeIn 0.4s ease forwards;
    }

    /* === UTILITIES === */
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 30px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 140, 0, 0.2);
      border-top: 4px solid var(--laranja);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .hidden {
      display: none;
    }

    .text-center {
      text-align: center;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: var(--transicao);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: var(--laranja);
      color: var(--branco);
      box-shadow: 0 2px 5px rgba(255, 140, 0, 0.3);
    }

    .btn-primary:hover {
      background-color: var(--vermelho);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(252, 82, 15, 0.4);
    }

    .btn-secondary {
      background-color: #e0e0e0;
      color: #333;
    }

    .btn-danger {
      background-color: #e74c3c;
      color: white;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .tag {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }

    .tag.ativo {
      background: var(--amarelo);
      color: var(--preto);
    }

    .tag.inativo {
      background: #ccc;
      color: #333;
    }

    .tag.politica {
      background: var(--vermelho);
      color: white;
    }

    .tag.cultura {
      background: var(--laranja);
      color: white;
    }

    .tag.eventos {
      background: #3498db;
      color: white;
    }

    .tag.comunidades {
      background: #2ecc71;
      color: white;
    }

    .tag.servicos {
      background: #9b59b6;
      color: white;
    }

    /* === LOGIN ESPECIAL === */
    .login-message {
      text-align: center;
      color: #666;
      margin: 15px 0;
      font-size: 14px;
      display: none;
    }

    .login-message.visible {
      display: block;
    }

    .login-message i {
      margin-right: 5px;
    }

    /* === HEADER MOBILE === */
    .admin-header {
      display: none;
      padding: 16px;
      background: var(--branco);
      border-bottom: 1px solid #eee;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: var(--sombra);
    }

    .menu-toggle {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--preto);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transicao);
    }

    .menu-toggle:hover {
      background-color: #f0f0f0;
    }

    .logo-mobile {
      font-size: 20px;
      font-weight: bold;
      color: var(--preto);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-mobile span {
      color: var(--vermelho);
    }

    /* === LAYOUT GERAL === */
    .admin-container {
      display: flex;
      min-height: 100vh;
    }

    /* === SIDEBAR === */
    .sidebar {
      width: 260px;
      background-color: var(--cinza-sidebar);
      color: var(--branco);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      transition: transform 0.3s ease, width 0.3s ease;
      box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
    }

    @media (min-width: 769px) {
      .sidebar {
        transform: translateX(0) !important;
      }
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar:hover {
      box-shadow: 5px 0 15px rgba(0, 0, 0, 0.15);
    }

    .logo-admin {
      text-align: center;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
      font-size: 22px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .logo-admin i {
      color: var(--amarelo);
      font-size: 24px;
    }

    .logo-admin span {
      color: var(--amarelo);
    }

    .nav-item {
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 14px;
      cursor: pointer;
      transition: var(--transicao);
      font-weight: 500;
      position: relative;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .nav-item.active {
      background-color: rgba(255, 255, 255, 0.15);
      border-left: 3px solid var(--amarelo);
    }

    .nav-item i {
      font-size: 18px;
      width: 24px;
      text-align: center;
      transition: var(--transicao);
    }

    .nav-item.active i,
    .nav-item:hover i {
      transform: scale(1.1);
      color: var(--amarelo);
    }

    .nav-item span {
      transition: var(--transicao);
    }

    /* === CONTEÚDO PRINCIPAL === */
    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 24px;
      transition: margin-left 0.3s ease;
    }

    .sidebar.collapsed+.main-content {
      margin-left: 0;
    }

    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }

    .header-bar h1 {
      font-size: 28px;
      color: var(--preto);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-bar h1 i {
      color: var(--laranja);
    }

    /* === CARDS DE ESTATÍSTICA === */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--cinza-card);
      padding: 24px;
      border-radius: 12px;
      box-shadow: var(--sombra);
      text-align: center;
      transition: var(--transicao);
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--sombra-hover);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
      background: var(--laranja);
    }

    .stat-card.politica::before {
      background: var(--vermelho);
    }

    .stat-card.cultura::before {
      background: var(--laranja);
    }

    .stat-card.anuncios::before {
      background: #3498db;
    }

    .stat-card h3 {
      font-size: 16px;
      color: #666;
      margin-bottom: 12px;
      font-weight: 500;
    }

    .stat-card .value {
      font-size: 36px;
      font-weight: bold;
      color: var(--laranja);
    }

    /* === TABELAS === */
    .table-container {
      background: var(--cinza-card);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--sombra);
      margin-bottom: 30px;
      transition: var(--transicao);
    }

    .table-container:hover {
      box-shadow: var(--sombra-hover);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 16px 20px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
      font-size: 15px;
      position: sticky;
      top: 0;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background-color: #fdf6e3;
    }

    tr:hover {
      transform: translateX(5px);
    }

    .table-actions {
      display: flex;
      gap: 8px;
    }

    .table-btn {
      padding: 6px 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: var(--transicao);
    }

    .table-btn.edit {
      background-color: #3498db;
      color: white;
    }

    .table-btn.delete {
      background-color: #e74c3c;
      color: white;
    }

    .table-btn:hover {
      opacity: 0.9;
      transform: scale(1.05);
    }

    /* === FORMULÁRIOS === */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
      font-size: 15px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: var(--transicao);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--laranja);
      box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.2);
    }

    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }

    .image-preview {
      width: 100%;
      height: 200px;
      background-color: #f5f5f5;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
      overflow: hidden;
      position: relative;
    }

    .image-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .image-preview.placeholder {
      color: #999;
      font-style: italic;
    }

    /* === MODAL === */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: white;
      padding: 28px;
      border-radius: 16px;
      width: 90%;
      max-width: 700px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transform: scale(0.9);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      position: relative;
    }

    .modal-content.active {
      transform: scale(1);
      opacity: 1;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #eee;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--preto);
    }

    .close-modal {
      font-size: 28px;
      cursor: pointer;
      color: #999;
      transition: var(--transicao);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-modal:hover {
      color: var(--vermelho);
      background: #f5f5f5;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    /* === NOTIFICATIONS === */
    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 350px;
    }

    .toast {
      padding: 16px 24px;
      border-radius: 10px;
      color: white;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 12px;
      transform: translateX(120%);
      transition: transform 0.3s ease, opacity 0.3s ease;
      animation: slideIn 0.4s forwards, fadeOut 0.7s 2.5s forwards;
      z-index: 10000;
    }

    .toast.show {
      transform: translateX(0);
    }

    @keyframes slideIn {
      from {
        transform: translateX(120%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
        transform: translateX(0);
      }

      to {
        opacity: 0;
        transform: translateX(120%);
      }
    }

    .toast.success {
      background: linear-gradient(135deg, #28a745, #20c997);
    }

    .toast.error {
      background: linear-gradient(135deg, #dc3545, #e74c3c);
    }

    .toast.info {
      background: linear-gradient(135deg, #17a2b8, #3498db);
    }

    .toast i {
      font-size: 20px;
    }

    /* === RESPONSIVIDADE === */
    @media (max-width: 768px) {
      .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .sidebar {
        width: 280px;
        transform: translateX(0);
      }

      .sidebar.collapsed {
        transform: translateX(-100%);
      }

      .main-content {
        margin-left: 0;
        padding: 16px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .header-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .table-container {
        overflow-x: auto;
      }

      th,
      td {
        padding: 12px 16px;
        font-size: 14px;
      }

      .nav-item span {
        display: none;
      }

      .nav-item i {
        margin: 0 auto;
      }

      .logo-admin {
        font-size: 18px;
      }
    }

    /* === LOGIN MODAL === */
    #login-modal-content {
      background: white;
      padding: 40px;
      border-radius: 16px;
      width: 90%;
      max-width: 450px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      text-align: center;
      transform: scale(0.8);
      opacity: 0;
      transition: transform 0.4s ease, opacity 0.4s ease;
    }

    #login-modal-content.active {
      transform: scale(1);
      opacity: 1;
    }

    #login-modal .logo-admin {
      margin-bottom: 25px;
      font-size: 28px;
    }

    #login-form {
      margin-top: 20px;
    }

    .login-input {
      width: 100%;
      padding: 16px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      transition: var(--transicao);
    }

    .login-input:focus {
      border-color: var(--laranja);
      box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.2);
    }

    #login-submit {
      width: 100%;
      padding: 14px;
      font-size: 18px;
      margin-top: 10px;
      background: var(--laranja);
      transition: var(--transicao);
    }

    #login-submit:hover {
      background: var(--vermelho);
    }

    #login-submit:disabled {
      opacity: 0.7;
      transform: none;
      cursor: not-allowed;
    }

    .credentials-info {
      margin-top: 25px;
      padding: 15px;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 10px;
      font-size: 14px;
      color: #555;
    }

    .credentials-info strong {
      color: var(--vermelho);
    }

    #login-error {
      color: var(--vermelho);
      margin-top: 15px;
      padding: 12px;
      background: rgba(252, 82, 15, 0.1);
      border-radius: 8px;
      display: none;
    }
  </style>
</head>

<body>
  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Modal de Login Obrigatório -->
  <div id="login-modal" class="modal" style="display: flex;">
    <div id="login-modal-content">
      <div class="logo-admin">
        <i class="fas fa-lock"></i>
        <span>Área Administrativa</span>
      </div>
      <p style="color: #666; margin-bottom: 25px;">Acesso restrito a administradores</p>
      <form id="login-form">
        <div class="form-group">
          <input type="email" id="login-email" class="login-input" placeholder="E-mail administrativo" required>
        </div>
        <div class="form-group">
          <input type="password" id="login-password" class="login-input" placeholder="Senha administrativa" required>
        </div>
        <div class="login-message" id="login-message">
          <i class="fas fa-spinner fa-spin"></i> Conectando ao servidor...
        </div>
        <button type="submit" class="btn btn-primary" id="login-submit">
          <i class="fas fa-sign-in-alt"></i> Entrar
        </button>
      </form>
      <div id="login-error"></div>
      <div class="credentials-info">
        <p>Credenciais padrão de acesso:</p>
        <p><strong>E-mail:</strong> admin@admin.com</p>
        <p><strong>Senha:</strong> admin123</p>
      </div>
    </div>
  </div>

  <!-- Header Mobile -->
  <header class="admin-header">
    <button class="menu-toggle" id="menu-toggle">
      <i class="fas fa-bars"></i>
    </button>
    <div class="logo-mobile">
      <i class="fas fa-crown"></i>
      <span>GERA Admin</span>
    </div>
    <div id="mobile-user-info" style="display: flex; align-items: center; gap: 8px;">
      <i class="fas fa-user-circle" style="font-size: 24px; color: var(--laranja);"></i>
    </div>
  </header>

  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="logo-admin">
        <i class="fas fa-newspaper"></i>
        <span>Admin Notícias</span>
      </div>
      <div class="nav-item active" data-page="dashboard">
        <i class="fas fa-tachometer-alt"></i>
        <span>Dashboard</span>
      </div>
      <div class="nav-item" data-page="noticias">
        <i class="fas fa-newspaper"></i>
        <span>Notícias</span>
      </div>
      <div class="nav-item" data-page="usuarios">
        <i class="fas fa-users"></i>
        <span>Usuários</span>
      </div>
      <div class="nav-item" data-page="publicidade">
        <i class="fas fa-ad"></i>
        <span>Publicidade</span>
      </div>
      <div class="nav-item" id="logout-btn">
        <i class="fas fa-sign-out-alt"></i>
        <span>Sair</span>
      </div>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="main-content">
      <!-- Dashboard -->
      <div id="dashboard-page" class="page-content">
        <div class="header-bar">
          <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
        </div>
        <div class="stats-grid">
          <div class="stat-card fade-in">
            <h3>Usuários Cadastrados</h3>
            <div class="value" id="total-usuarios">--</div>
          </div>
          <div class="stat-card fade-in">
            <h3>Notícias Publicadas</h3>
            <div class="value" id="total-noticias">--</div>
          </div>
          <div class="stat-card fade-in">
            <h3>Anúncios Ativos</h3>
            <div class="value" id="total-anuncios">--</div>
          </div>
          <div class="stat-card fade-in">
            <h3>Última Atividade</h3>
            <div class="value" id="ultima-atividade">--</div>
          </div>
        </div>
        <h2 style="margin: 30px 0 20px; font-size: 22px; color: #333;">Atividades Recentes</h2>
        <div class="table-container fade-in">
          <table id="acoes-table">
            <thead>
              <tr>
                <th><i class="fas fa-user"></i> Usuário</th>
                <th><i class="fas fa-tasks"></i> Ação</th>
                <th><i class="fas fa-tag"></i> Categoria</th>
                <th><i class="fas fa-clock"></i> Data</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" class="text-center loading-container">
                  <div class="spinner"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Notícias -->
      <div id="noticias-page" class="page-content" style="display: none;">
        <div class="header-bar">
          <h1><i class="fas fa-newspaper"></i> Gerenciar Notícias</h1>
          <button class="btn btn-primary" id="add-noticia-btn">
            <i class="fas fa-plus"></i> Nova Notícia
          </button>
        </div>
        <div class="table-container fade-in">
          <table id="noticias-table">
            <thead>
              <tr>
                <th>Título</th>
                <th>Categoria</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" class="text-center loading-container">
                  <div class="spinner"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Usuários -->
      <div id="usuarios-page" class="page-content" style="display: none;">
        <div class="header-bar">
          <h1><i class="fas fa-users"></i> Usuários</h1>
          <button class="btn btn-primary" id="export-leads">
            <i class="fas fa-file-export"></i> Exportar Leads
          </button>
        </div>
        <div class="table-container fade-in">
          <table id="usuarios-table">
            <thead>
              <tr>
                <th>Nome</th>
                <th>E-mail</th>
                <th>Data de Cadastro</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="3" class="text-center loading-container">
                  <div class="spinner"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Publicidade -->
      <div id="publicidade-page" class="page-content" style="display: none;">
        <div class="header-bar">
          <h1><i class="fas fa-ad"></i> Gerenciar Anúncios</h1>
          <button class="btn btn-primary" id="add-anuncio-btn">
            <i class="fas fa-plus"></i> Novo Anúncio
          </button>
        </div>
        <div class="table-container fade-in">
          <table id="anuncios-table">
            <thead>
              <tr>
                <th>Empresa</th>
                <th>Status</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" class="text-center loading-container">
                  <div class="spinner"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal de Nova Notícia -->
  <div class="modal" id="noticia-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-noticia-title">Nova Notícia</h2>
        <span class="close-modal">&times;</span>
      </div>
      <form id="noticia-form">
        <div class="form-grid">
          <div class="form-group">
            <label for="titulo">Título *</label>
            <input type="text" id="titulo" placeholder="Digite o título da notícia" required>
          </div>
          <div class="form-group">
            <label for="categoria">Categoria *</label>
            <select id="categoria" required>
              <option value="Política">Política</option>
              <option value="Cultura">Cultura</option>
              <option value="Eventos">Eventos</option>
              <option value="Comunidades">Comunidades</option>
              <option value="Serviços">Serviços</option>
            </select>
          </div>
          <div class="form-group">
            <label for="resumo">Resumo *</label>
            <textarea id="resumo" placeholder="Digite um resumo da notícia" required></textarea>
          </div>
          <div class="form-group">
            <label for="corpo">Corpo *</label>
            <textarea id="corpo" placeholder="Digite o conteúdo completo da notícia" required></textarea>
          </div>
          <div class="form-group">
            <label for="imagem-noticia">Imagem</label>
            <input type="file" id="imagem-noticia" accept="image/*">
            <div class="image-preview placeholder" id="preview-noticia">
              <i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary close-noticia-modal">Cancelar</button>
          <button type="submit" class="btn btn-primary" id="save-noticia-btn">
            <i class="fas fa-save"></i> Salvar Notícia
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Novo Anúncio -->
  <div class="modal" id="anuncio-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Novo Anúncio</h2>
        <span class="close-modal">&times;</span>
      </div>
      <form id="anuncio-form" enctype="multipart/form-data">
        <div class="form-grid">
          <div class="form-group">
            <label for="nome-anuncio">Nome *</label>
            <input type="text" id="nome-anuncio" placeholder="Digite seu nome completo" required>
          </div>
          <div class="form-group">
            <label for="empresa-anuncio">Empresa *</label>
            <input type="text" id="empresa-anuncio" placeholder="Nome da empresa" required>
          </div>
          <div class="form-group">
            <label for="email-anuncio">E-mail *</label>
            <input type="email" id="email-anuncio" placeholder="seu@email.com" required>
          </div>
          <div class="form-group">
            <label for="telefone-anuncio">Telefone *</label>
            <input type="tel" id="telefone-anuncio" placeholder="(99) 99999-9999" required>
          </div>
          <div class="form-group">
            <label for="tipo-anuncio">Tipo *</label>
            <select id="tipo-anuncio" required>
              <option value="banner">Banner Lateral</option>
              <option value="destaque">Notícia em Destaque</option>
              <option value="patrocinio">Patrocínio de Categoria</option>
            </select>
          </div>
          <div class="form-group">
            <label for="mensagem-anuncio">Mensagem *</label>
            <textarea id="mensagem-anuncio" placeholder="Descreva seu interesse..." required></textarea>
          </div>
          <div class="form-group">
            <label for="imagem-anuncio">Imagem do Anúncio</label>
            <input type="file" id="imagem-anuncio" accept="image/*">
            <div class="image-preview placeholder" id="preview-anuncio">
              <i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary close-anuncio-modal">Cancelar</button>
          <button type="submit" class="btn btn-primary" id="save-anuncio-btn">
            <i class="fas fa-save"></i> Salvar Anúncio
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Confirmação -->
  <div class="modal" id="confirm-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="confirm-title">Confirmar Ação</h2>
        <span class="close-modal">&times;</span>
      </div>
      <p id="confirm-message" style="margin: 20px 0; font-size: 16px;"></p>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="confirm-cancel">Cancelar</button>
        <button class="btn btn-danger" id="confirm-action">Confirmar</button>
      </div>
    </div>
  </div>

  <script>
    // =====================
    // CONFIGURAÇÃO GLOBAL
    // =====================
    const API_BASE = 'https://backend-gera.onrender.com';
    const MODAL_DELAY = 300; // Tempo para animações de modal

    // =====================
    // UTILITIES
    // =====================
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');

      // Criar toast
      const toast = document.createElement('div');
      toast.className = `toast ${type} show`;
      toast.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
        <span>${message}</span>
      `;

      // Adicionar ao container
      container.appendChild(toast);

      // Remover após animação
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }, 3000);
    }

    function showLoading(element) {
      element.innerHTML = `
        <tr>
          <td colspan="100%" class="text-center loading-container">
            <div class="spinner"></div>
          </td>
        </tr>
      `;
    }

    function showError(element, message) {
      element.innerHTML = `<tr><td colspan="100%" class="text-center error" style="padding: 20px; color: #e74c3c;">${message}</td></tr>`;
    }

    function formatDateTime(dateString) {
      if (!dateString) return 'Data não disponível';
      const date = new Date(dateString);
      return date.toLocaleString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Função para preview de imagem
    function previewImage(input, previewElement) {
      if (input.files && input.files[0]) {
        const file = input.files[0];
        if (!file.type.match('image.*')) {
          showToast('Por favor, selecione uma imagem válida.', 'error');
          input.value = '';
          return;
        }

        if (file.size > 5 * 1024 * 1024) { // 5MB
          showToast(`A imagem é muito grande (${formatFileSize(file.size)}). O máximo permitido é 5MB.`, 'error');
          input.value = '';
          return;
        }

        const reader = new FileReader();

        reader.onload = function (e) {
          previewElement.innerHTML = `<img src="${e.target.result}" alt="Pré-visualização">`;
          previewElement.classList.remove('placeholder');
        };

        reader.readAsDataURL(file);
      } else {
        previewElement.innerHTML = `<i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>`;
        previewElement.classList.add('placeholder');
      }
    }

    // Função para mostrar modal de confirmação
    function showConfirmModal(title, message, onConfirm) {
      document.getElementById('confirm-title').textContent = title;
      document.getElementById('confirm-message').textContent = message;
      document.getElementById('confirm-modal').style.display = 'flex';

      // Remover eventos anteriores
      const confirmAction = document.getElementById('confirm-action');
      const confirmCancel = document.getElementById('confirm-cancel');
      const closeModal = document.querySelector('#confirm-modal .close-modal');

      // Novos eventos
      const handleConfirm = () => {
        onConfirm();
        hideModal('confirm-modal');
        confirmAction.removeEventListener('click', handleConfirm);
        confirmCancel.removeEventListener('click', handleCancel);
        closeModal.removeEventListener('click', handleCancel);
      };

      const handleCancel = () => {
        hideModal('confirm-modal');
        confirmAction.removeEventListener('click', handleConfirm);
        confirmCancel.removeEventListener('click', handleCancel);
        closeModal.removeEventListener('click', handleCancel);
      };

      confirmAction.addEventListener('click', handleConfirm);
      confirmCancel.addEventListener('click', handleCancel);
      closeModal.addEventListener('click', handleCancel);

      // Fechar modal ao clicar fora do conteúdo
      document.getElementById('confirm-modal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('confirm-modal')) {
          handleCancel();
        }
      });
    }

    // Função genérica para mostrar modais
    function showModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.style.display = 'flex';

      // Pequeno delay para permitir a animação de fade-in
      setTimeout(() => {
        modal.querySelector('.modal-content').classList.add('active');
      }, 10);

      // Fechar modal ao clicar fora do conteúdo
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          hideModal(modalId);
        }
      });
    }

    // Função genérica para esconder modais
    function hideModal(modalId) {
      const modal = document.getElementById(modalId);
      const content = modal.querySelector('.modal-content');

      content.classList.remove('active');

      // Esperar a animação terminar antes de esconder completamente
      setTimeout(() => {
        modal.style.display = 'none';
        // Resetar formulários quando o modal é fechado
        if (modalId === 'noticia-modal') {
          document.getElementById('noticia-form').reset();
          document.getElementById('preview-noticia').innerHTML = `<i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>`;
          document.getElementById('preview-noticia').classList.add('placeholder');
        } else if (modalId === 'anuncio-modal') {
          document.getElementById('anuncio-form').reset();
          document.getElementById('preview-anuncio').innerHTML = `<i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>`;
          document.getElementById('preview-anuncio').classList.add('placeholder');
        }
      }, MODAL_DELAY);
    }

    // =====================
    // AUTENTICAÇÃO - CORRIGIDA
    // =====================
    function checkAuth() {
      const isLoggedIn = sessionStorage.getItem('gera_admin_logged_in') === 'true';
      const loginModal = document.getElementById('login-modal');

      if (isLoggedIn) {
        loginModal.style.display = 'none';
        document.getElementById('login-modal-content').classList.remove('active');

        // Carregar dados após login
        loadDashboardData();
        loadRealtimeActions();
      } else {
        loginModal.style.display = 'flex';
        setTimeout(() => {
          document.getElementById('login-modal-content').classList.add('active');
        }, 50);
      }
    }

    async function handleLogin(email, password) {
      const submitBtn = document.getElementById('login-submit');
      const loginMessage = document.getElementById('login-message');
      const errorDiv = document.getElementById('login-error');

      // Desabilitar botão e mostrar estado de carregamento
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Autenticando...';
      loginMessage.classList.add('visible');
      errorDiv.style.display = 'none';

      try {
        // Verificar credenciais hardcoded (apenas para admin)
        if (email === 'admin@admin.com' && password === 'admin123') {
          // Armazenar dados de autenticação
          sessionStorage.setItem('gera_admin_logged_in', 'true');
          sessionStorage.setItem('gera_admin_email', email);
          sessionStorage.setItem('gera_admin_token', 'admin123'); // Token fixo

          // Esconder modal de login
          document.getElementById('login-modal-content').classList.remove('active');
          setTimeout(() => {
            document.getElementById('login-modal').style.display = 'none';
          }, 400);

          showToast('Login realizado com sucesso!', 'success');

          // Carregar dados após login
          loadDashboardData();
          loadRealtimeActions();
        } else {
          throw new Error('Credenciais inválidas.');
        }
      } catch (err) {
        console.error('Erro de login:', err);
        showErrorLogin(err.message || 'Credenciais inválidas. Tente novamente.');
      } finally {
        // Reabilitar botão
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Entrar';
        loginMessage.classList.remove('visible');
      }
    }

    function showErrorLogin(message) {
      const errorDiv = document.getElementById('login-error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }

    // =====================
    // UPLOAD DE IMAGENS
    // =====================
    async function uploadImage(file, onProgress = null) {
      if (!file) return null;

      const formData = new FormData();
      formData.append('imagem', file);

      try {
        const res = await fetch(`${API_BASE}/api/upload`, {
          method: 'POST',
          body: formData
        });

        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.error || 'Erro ao fazer upload da imagem');
        }

        const result = await res.json();
        return result.filename;
      } catch (err) {
        console.error('Erro no upload:', err);
        showToast('Erro ao fazer upload da imagem. Tente novamente.', 'error');
        return null;
      }
    }

    // =====================
    // CRUD NOTÍCIAS
    // =====================
    async function loadNoticias() {
      const tbody = document.querySelector('#noticias-table tbody');
      showLoading(tbody);

      try {
        const res = await fetch(`${API_BASE}/api/admin/news`);
        if (!res.ok) throw new Error('Erro ao carregar notícias');

        const noticias = await res.json();

        if (noticias.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4" class="text-center" style="padding: 30px;">Nenhuma notícia cadastrada.</td></tr>`;
          return;
        }

        tbody.innerHTML = '';
        noticias.forEach((n, index) => {
          const tr = document.createElement('tr');
          tr.style.animationDelay = `${index * 0.05}s`;
          tr.classList.add('fade-in');

          // Formatar data
          const data = n.data ? new Date(n.data.replace(' às ', ' ')) : new Date();
          const dataFormatada = data.toLocaleDateString('pt-BR');

          tr.innerHTML = `
            <td style="font-weight: 500; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${n.titulo}</td>
            <td><span class="tag ${n.categoria.toLowerCase()}">${n.categoria}</span></td>
            <td>${dataFormatada}</td>
            <td>
              <div class="table-actions">
                <button class="table-btn edit" data-id="${n.id}" title="Editar">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="table-btn delete" data-id="${n.id}" title="Excluir">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });

        // Adicionar eventos aos botões
        document.querySelectorAll('.table-btn.edit').forEach(btn => {
          btn.addEventListener('click', () => openEditNoticia(btn.dataset.id));
        });

        document.querySelectorAll('.table-btn.delete').forEach(btn => {
          btn.addEventListener('click', () => {
            showConfirmModal(
              'Excluir Notícia',
              'Tem certeza que deseja excluir esta notícia? Esta ação não pode ser desfeita.',
              () => deleteNoticia(btn.dataset.id)
            );
          });
        });

      } catch (err) {
        console.error('Erro ao carregar notícias:', err);
        showError(tbody, 'Erro ao carregar notícias. Tente novamente mais tarde.');
      }
    }

    async function openEditNoticia(id) {
      try {
        // Carregar dados da notícia
        const res = await fetch(`${API_BASE}/api/noticia?id=${id}`);
        if (!res.ok) throw new Error('Notícia não encontrada');

        const noticia = await res.json();

        // Preencher formulário
        document.getElementById('titulo').value = noticia.titulo || '';
        document.getElementById('categoria').value = noticia.categoria || 'Política';
        document.getElementById('resumo').value = noticia.resumo || '';
        document.getElementById('corpo').value = noticia.corpo || '';
        document.getElementById('modal-noticia-title').textContent = 'Editar Notícia';

        // Mostrar preview da imagem existente
        if (noticia.imagem) {
          document.getElementById('preview-noticia').innerHTML = `<img src="${noticia.imagem.startsWith('http') ? noticia.imagem : 'https://backend-gera.onrender.com' + noticia.imagem}" alt="${noticia.titulo}">`;
          document.getElementById('preview-noticia').classList.remove('placeholder');
        } else {
          document.getElementById('preview-noticia').innerHTML = `<i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>`;
          document.getElementById('preview-noticia').classList.add('placeholder');
        }

        // Mostrar modal
        showModal('noticia-modal');

        // Configurar submit para atualização
        const form = document.getElementById('noticia-form');
        form.dataset.editId = id;
        form.dataset.currentImage = noticia.imagem || '';

        // Remover evento antigo se existir
        form.removeEventListener('submit', handleNewNoticiaSubmit);
        form.addEventListener('submit', handleEditNoticiaSubmit);

      } catch (err) {
        console.error('Erro ao carregar notícia:', err);
        showToast('Erro ao carregar notícia para edição.', 'error');
      }
    }

    async function handleNewNoticiaSubmit(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('save-noticia-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';

      try {
        const file = document.getElementById('imagem-noticia').files[0];
        let imagemUrl = null;

        if (file) {
          imagemUrl = await uploadImage(file);
        }

        const noticiaData = {
          titulo: document.getElementById('titulo').value,
          categoria: document.getElementById('categoria').value,
          resumo: document.getElementById('resumo').value,
          corpo: document.getElementById('corpo').value,
          imagem: imagemUrl
        };

        const res = await fetch(`${API_BASE}/api/add-news`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(noticiaData)
        });

        const result = await res.json();

        if (res.ok && result.success) {
          showToast('Notícia cadastrada com sucesso!', 'success');
          hideModal('noticia-modal');
          loadNoticias();
        } else {
          throw new Error(result.error || 'Erro ao cadastrar notícia');
        }

      } catch (err) {
        console.error('Erro ao cadastrar notícia:', err);
        showToast(err.message || 'Erro ao cadastrar notícia. Tente novamente.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Notícia';
      }
    }

    async function handleEditNoticiaSubmit(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('save-noticia-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';

      try {
        const noticiaId = e.target.dataset.editId;
        const currentImage = e.target.dataset.currentImage;
        let imagemUrl = currentImage;

        // Verificar se há nova imagem
        const file = document.getElementById('imagem-noticia').files[0];
        if (file) {
          imagemUrl = await uploadImage(file);
        }

        const noticiaData = {
          id: noticiaId,
          titulo: document.getElementById('titulo').value,
          categoria: document.getElementById('categoria').value,
          resumo: document.getElementById('resumo').value,
          corpo: document.getElementById('corpo').value,
          imagem: imagemUrl
        };

        const res = await fetch(`${API_BASE}/api/update-news`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(noticiaData)
        });

        const result = await res.json();

        if (res.ok && result.success) {
          showToast('Notícia atualizada com sucesso!', 'success');
          hideModal('noticia-modal');
          loadNoticias();
        } else {
          throw new Error(result.error || 'Erro ao atualizar notícia');
        }

      } catch (err) {
        console.error('Erro ao atualizar notícia:', err);
        showToast(err.message || 'Erro ao atualizar notícia. Tente novamente.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Notícia';
      }
    }

    async function deleteNoticia(id) {
      try {
        const res = await fetch(`${API_BASE}/api/delete-news/${id}`, {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ senha: 'admin123' })
        });

        const result = await res.json();

        if (res.ok && result.success) {
          showToast('Notícia excluída com sucesso!', 'success');
          loadNoticias();
        } else {
          throw new Error(result.error || 'Erro ao excluir notícia');
        }

      } catch (err) {
        console.error('Erro ao excluir notícia:', err);
        showToast(err.message || 'Erro ao excluir notícia. Tente novamente.', 'error');
      }
    }

    // =====================
    // CRUD ANÚNCIOS
    // =====================
    async function loadAnuncios() {
      const tbody = document.querySelector('#anuncios-table tbody');
      showLoading(tbody);

      try {
        const res = await fetch(`${API_BASE}/api/admin/ads`);
        if (!res.ok) throw new Error('Erro ao carregar anúncios');

        const anuncios = await res.json();

        if (anuncios.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4" class="text-center" style="padding: 30px;">Nenhum anúncio cadastrado.</td></tr>`;
          return;
        }

        tbody.innerHTML = '';
        anuncios.forEach((a, index) => {
          const tr = document.createElement('tr');
          tr.style.animationDelay = `${index * 0.05}s`;
          tr.classList.add('fade-in');

          // Formatar data
          const data = a.data ? new Date(a.data) : new Date();
          const dataFormatada = data.toLocaleDateString('pt-BR');

          tr.innerHTML = `
            <td style="font-weight: 500;">${a.empresa || a.nome}</td>
            <td><span class="tag ${a.status === 'ativo' ? 'ativo' : 'inativo'}">${a.status}</span></td>
            <td>${dataFormatada}</td>
            <td>
              <div class="table-actions">
                <button class="table-btn delete" data-id="${a.id}" title="Excluir">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });

        // Adicionar eventos aos botões
        document.querySelectorAll('.table-btn.delete').forEach(btn => {
          btn.addEventListener('click', () => {
            showConfirmModal(
              'Excluir Anúncio',
              'Tem certeza que deseja excluir este anúncio? Esta ação não pode ser desfeita.',
              () => deleteAnuncio(btn.dataset.id)
            );
          });
        });

      } catch (err) {
        console.error('Erro ao carregar anúncios:', err);
        showError(tbody, 'Erro ao carregar anúncios. Tente novamente mais tarde.');
      }
    }

    async function handleNewAnuncioSubmit(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('save-anuncio-btn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';

      try {
        const file = document.getElementById('imagem-anuncio').files[0];
        let imagemUrl = null;

        if (file) {
          imagemUrl = await uploadImage(file);
        }

        const anuncioData = {
          nome: document.getElementById('nome-anuncio').value,
          empresa: document.getElementById('empresa-anuncio').value,
          email: document.getElementById('email-anuncio').value,
          telefone: document.getElementById('telefone-anuncio').value,
          tipo: document.getElementById('tipo-anuncio').value,
          mensagem: document.getElementById('mensagem-anuncio').value,
          imagem: imagemUrl
        };

        const res = await fetch(`${API_BASE}/api/add-anuncio`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(anuncioData)
        });

        const result = await res.json();

        if (res.ok && result.success) {
          showToast('Anúncio cadastrado com sucesso!', 'success');
          hideModal('anuncio-modal');
          loadAnuncios();
        } else {
          throw new Error(result.error || 'Erro ao cadastrar anúncio');
        }

      } catch (err) {
        console.error('Erro ao cadastrar anúncio:', err);
        showToast(err.message || 'Erro ao cadastrar anúncio. Tente novamente.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Anúncio';
      }
    }

    async function deleteAnuncio(id) {
      try {
        const res = await fetch(`${API_BASE}/api/delete-anuncio/${id}`, {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ senha: 'admin123' })
        });

        const result = await res.json();

        if (res.ok && result.success) {
          showToast('Anúncio excluído com sucesso!', 'success');
          loadAnuncios();
        } else {
          throw new Error(result.error || 'Erro ao excluir anúncio');
        }

      } catch (err) {
        console.error('Erro ao excluir anúncio:', err);
        showToast(err.message || 'Erro ao excluir anúncio. Tente novamente.', 'error');
      }
    }

    // =====================
    // USUÁRIOS E DASHBOARD
    // =====================
    async function loadDashboardData() {
      try {
        const res = await fetch(`${API_BASE}/api/admin/dashboard`);
        if (!res.ok) throw new Error('Erro ao carregar dashboard');

        const data = await res.json();

        document.getElementById('total-usuarios').textContent = data.totalUsuarios || 0;
        document.getElementById('total-noticias').textContent = data.totalNoticias || 0;
        document.getElementById('total-anuncios').textContent = data.totalAnuncios || 0;
        document.getElementById('ultima-atividade').textContent = formatDateTime(new Date());

      } catch (err) {
        console.error('Erro ao carregar dashboard:', err);
      }
    }

    async function loadRealtimeActions() {
      const tbody = document.querySelector('#acoes-table tbody');
      showLoading(tbody);

      try {
        const res = await fetch(`${API_BASE}/api/realtime`);
        if (!res.ok) throw new Error('Erro ao carregar ações');

        const actions = await res.json();

        if (actions.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4" class="text-center" style="padding: 30px;">Nenhuma atividade recente.</td></tr>`;
          return;
        }

        tbody.innerHTML = '';
        actions.slice(0, 5).forEach((a, index) => {
          const tr = document.createElement('tr');
          tr.style.animationDelay = `${index * 0.05}s`;
          tr.classList.add('fade-in');

          tr.innerHTML = `
            <td>${a.usuario || 'Usuário'}</td>
            <td>${a.acao || 'Ação'}</td>
            <td><span class="tag ${a.categoria.toLowerCase()}">${a.categoria || 'Sistema'}</span></td>
            <td>${formatDateTime(a.data)}</td>
          `;
          tbody.appendChild(tr);
        });

      } catch (err) {
        console.error('Erro ao carregar ações:', err);
        showError(tbody, 'Erro ao carregar atividades recentes.');
      }
    }

    async function loadUsuarios() {
      const tbody = document.querySelector('#usuarios-table tbody');
      showLoading(tbody);

      try {
        const res = await fetch(`${API_BASE}/api/admin/users`);
        if (!res.ok) throw new Error('Erro ao carregar usuários');

        const usuarios = await res.json();

        if (usuarios.length === 0) {
          tbody.innerHTML = `<tr><td colspan="3" class="text-center" style="padding: 30px;">Nenhum usuário cadastrado.</td></tr>`;
          return;
        }

        tbody.innerHTML = '';
        usuarios.forEach((u, index) => {
          const tr = document.createElement('tr');
          tr.style.animationDelay = `${index * 0.05}s`;
          tr.classList.add('fade-in');

          tr.innerHTML = `
            <td>${u.nome || '—'}</td>
            <td>${u.email}</td>
            <td>${u.data_cadastro || formatDateTime(new Date())}</td>
          `;
          tbody.appendChild(tr);
        });

      } catch (err) {
        console.error('Erro ao carregar usuários:', err);
        showError(tbody, 'Erro ao carregar usuários. Tente novamente mais tarde.');
      }
    }

    async function exportLeads() {
      try {
        const res = await fetch(`${API_BASE}/api/export-leads`);
        if (!res.ok) throw new Error('Erro ao exportar leads');

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = `leads_usuarios_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();

        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

        showToast('Leads exportados com sucesso!', 'success');
      } catch (err) {
        console.error('Erro ao exportar leads:', err);
        showToast('Erro ao exportar leads. Tente novamente.', 'error');
      }
    }

    // =====================
    // EVENTOS E INICIALIZAÇÃO
    // =====================
    document.addEventListener('DOMContentLoaded', () => {
      // Verificar autenticação assim que a página carrega
      checkAuth();

      // Eventos de login
      document.getElementById('login-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        if (!email || !password) {
          showErrorLogin('Preencha todos os campos.');
          return;
        }

        handleLogin(email, password);
      });

      document.getElementById('login-password').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') document.getElementById('login-form').requestSubmit();
      });

      // Fechar modais com botões de cancelar
      document.querySelectorAll('.close-modal, .close-login-modal, .close-noticia-modal, .close-anuncio-modal').forEach(btn => {
        btn.addEventListener('click', function () {
          const modalId = this.closest('.modal').id;
          hideModal(modalId);
        });
      });

      // Eventos de navegação
      document.querySelectorAll('.nav-item[data-page]').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');

          document.querySelectorAll('.page-content').forEach(page => {
            page.style.display = 'none';
          });

          document.getElementById(item.dataset.page + '-page').style.display = 'block';

          // Carregar dados específicos da página
          if (item.dataset.page === 'noticias') {
            loadNoticias();
          } else if (item.dataset.page === 'usuarios') {
            loadUsuarios();
          } else if (item.dataset.page === 'publicidade') {
            loadAnuncios();
          }

          // Fechar sidebar em mobile
          if (window.innerWidth <= 768) {
            document.getElementById('sidebar').classList.add('collapsed');
            updateToggleIcon();
          }
        });
      });

      // Botão de logout
      document.getElementById('logout-btn').addEventListener('click', () => {
        showConfirmModal(
          'Sair do Sistema',
          'Tem certeza que deseja sair do painel administrativo?',
          () => {
            sessionStorage.removeItem('gera_admin_logged_in');
            sessionStorage.removeItem('gera_admin_email');
            sessionStorage.removeItem('gera_admin_token');
            location.reload();
          }
        );
      });

      // Eventos dos botões de adição
      document.getElementById('add-noticia-btn').addEventListener('click', () => {
        document.getElementById('modal-noticia-title').textContent = 'Nova Notícia';
        document.getElementById('noticia-form').dataset.editId = '';
        document.getElementById('noticia-form').dataset.currentImage = '';

        // Resetar formulário
        document.getElementById('noticia-form').reset();

        // Resetar preview de imagem
        document.getElementById('preview-noticia').innerHTML = `<i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>`;
        document.getElementById('preview-noticia').classList.add('placeholder');

        // Configurar submit para nova notícia
        const form = document.getElementById('noticia-form');
        form.removeEventListener('submit', handleEditNoticiaSubmit);
        form.addEventListener('submit', handleNewNoticiaSubmit);

        showModal('noticia-modal');
      });

      document.getElementById('add-anuncio-btn').addEventListener('click', () => {
        // Resetar formulário
        document.getElementById('anuncio-form').reset();

        // Resetar preview de imagem
        document.getElementById('preview-anuncio').innerHTML = `<i class="fas fa-image" style="font-size: 40px; color: #ddd;"></i>`;
        document.getElementById('preview-anuncio').classList.add('placeholder');

        // Configurar submit para novo anúncio
        const form = document.getElementById('anuncio-form');
        form.removeEventListener('submit', handleEditAnuncioSubmit);
        form.addEventListener('submit', handleNewAnuncioSubmit);

        showModal('anuncio-modal');
      });

      // Eventos de preview de imagem
      document.getElementById('imagem-noticia').addEventListener('change', function () {
        previewImage(this, document.getElementById('preview-noticia'));
      });

      document.getElementById('imagem-anuncio').addEventListener('change', function () {
        previewImage(this, document.getElementById('preview-anuncio'));
      });

      // Evento de exportação de leads
      document.getElementById('export-leads').addEventListener('click', exportLeads);

      // Eventos mobile
      const menuToggle = document.getElementById('menu-toggle');
      menuToggle.addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('collapsed');
        updateToggleIcon();
      });

      // Fechar sidebar ao clicar fora em mobile
      document.addEventListener('click', (e) => {
        const sidebar = document.getElementById('sidebar');
        const isClickInsideSidebar = sidebar.contains(e.target);
        const isClickOnToggle = menuToggle.contains(e.target);

        if (!isClickInsideSidebar && !isClickOnToggle && window.innerWidth <= 768) {
          sidebar.classList.add('collapsed');
          updateToggleIcon();
        }
      });

      // Atualizar ícone do menu toggle
      function updateToggleIcon() {
        menuToggle.innerHTML = sidebar.classList.contains('collapsed') ?
          '<i class="fas fa-bars"></i>' : '<i class="fas fa-times"></i>';
      }

      // Inicializar estado inicial
      updateToggleIcon();

      // Garantir que o login modal apareça corretamente
      setTimeout(() => {
        document.getElementById('login-modal-content').classList.add('active');
      }, 100);

      // Auto-logout após 10 minutos de inatividade
      let inactivityTimer;
      const INACTIVITY_TIME = 10 * 60 * 1000; // 10 minutos

      function resetInactivityTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(logoutDueToInactivity, INACTIVITY_TIME);
      }

      function logoutDueToInactivity() {
        sessionStorage.removeItem('gera_admin_logged_in');
        sessionStorage.removeItem('gera_admin_email');
        sessionStorage.removeItem('gera_admin_token');
        location.reload();
      }

      // Reset timer on user activity
      document.addEventListener('mousemove', resetInactivityTimer);
      document.addEventListener('keypress', resetInactivityTimer);
      document.addEventListener('click', resetInactivityTimer);
      document.addEventListener('scroll', resetInactivityTimer);

      // Initialize the timer if user is logged in
      if (sessionStorage.getItem('gera_admin_logged_in') === 'true') {
        resetInactivityTimer();
      }
    });
  </script>
</body>

</html>